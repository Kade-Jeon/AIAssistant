spring:
  application:
    name: AIAssistant
  profiles:
    active: dev
  server:
    port: 8080

  # DatabaseDriver 오류 회피: JDBC Chat Memory 스키마 자동 초기화 비활성화 → schema.sql로 대체
  autoconfigure:
    exclude:
      - org.springframework.ai.model.chat.memory.repository.jdbc.autoconfigure.JdbcChatMemoryRepositoryAutoConfiguration

  # Virtual Thread 설정
  threads:
    virtual:
      enabled: true

  # 프롬프트 / 대화 캐싱 Redis 서버
  data:
    redis:
      host: localhost
      port: 6389
  #      username: default
  #      password: crinity21!

  # RDB (채팅 메모리 영구 저장)
  datasource:
    url: jdbc:postgresql://localhost:54321/aichat
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver

  # schema.sql로 SPRING_AI_CHAT_MEMORY 테이블 생성 (JdbcChatMemoryRepository auto-config 제외 시 필요)
  sql:
    init:
      mode: always

  # Ollama
  ai:
    ollama:
      base-url: http://192.168.200.166:11434
      chat:
        model: qwen2.5:1.5b
    # JDBC Chat Memory: 스키마는 schema.sql로 직접 초기화 (auto-config 제외로 DatabaseDriver 오류 회피)
    chat:
      memory:
        repository:
          jdbc:
            initialize-schema: never
  # Langfuse
  chat:
    observations:
      log-prompt: false      # 프롬프트 내용 로깅 (개인정보 주의)
      log-completion: false  # 응답 내용 로깅

# 기본 애플리케이션 설정
app:
  sse:
    timeout: 300000  # 기본값: 5분 (밀리초)
  subject-generation:
    timeout-seconds: 30  # 제목 생성 AI 호출 타임아웃(초), 초과 시 질문 앞 36자 사용

# OpenTelemetry 설정 (Langfuse는 Traces만 수집하므로 Logs/Metrics 전송 비활성화)
otel:
  resource:
    attributes:
      deployment.environment: ${spring.profiles.active:default}
      service.name: ${spring.application.name}
  logs:
    exporter: none
  metrics:
    exporter: none
  traces:
    exporter: otlp

# 관리용 엔드포인트 설정
management:
  tracing:
    sampling:
      probability: 1.0 # 100% 트레이싱 샘플링 (운영 환경에서는 조절 필요)
  endpoints:
    web:
      exposure:
        include: health,info,metrics,caches  # 캐시 관련 엔드포인트 포함
  endpoint:
    caches:
      enabled: true  # 캐시 상태 확인 엔드포인트 활성화

# 로깅
logging:
  level:
    com.crinity.ai: INFO
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

langfuse:
  public-key: ${LANGFUSE_PUBLIC_KEY}
  secret-key: ${LANGFUSE_SECRET_KEY}